import re
from argparse import ArgumentParser
from pathlib import Path
from pprint import pformat

# fmt: off
ZMK_KEYCODES = {'A', 'ALT_ERASE', 'AMPERSAND', 'AMPS', 'APOS', 'APOSTROPHE', 'ASTERISK',
 'ASTRK', 'AT', 'ATTENTION', 'AT_SIGN', 'B', 'BACKSLASH', 'BACKSPACE', 'BSLH',
 'BSPC', 'C', 'CAPS', 'CAPSLOCK', 'CARET', 'CLCK', 'CLEAR', 'CLEAR2',
 'CLEAR_AGAIN', 'COLON', 'COMMA', 'CRSEL', 'CURU', 'C_AC_BACK',
 'C_AC_BOOKMARKS', 'C_AC_CANCEL', 'C_AC_CLOSE', 'C_AC_COPY', 'C_AC_CUT',
 'C_AC_DEL', 'C_AC_DESKTOP_SHOW_ALL_APPLICATIONS',
 'C_AC_DESKTOP_SHOW_ALL_WINDOWS', 'C_AC_EDIT', 'C_AC_EXIT', 'C_AC_FAVORITES',
 'C_AC_FAVOURITES', 'C_AC_FIND', 'C_AC_FORWARD', 'C_AC_FORWARD_MAIL',
 'C_AC_GOTO', 'C_AC_HOME', 'C_AC_INS', 'C_AC_INSERT', 'C_AC_NEW',
 'C_AC_NEXT_KEYBOARD_LAYOUT_SELECT', 'C_AC_OPEN', 'C_AC_PASTE', 'C_AC_PRINT',
 'C_AC_PROPERTIES', 'C_AC_PROPS', 'C_AC_REDO', 'C_AC_REFRESH', 'C_AC_REPLY',
 'C_AC_SAVE', 'C_AC_SCROLL_DOWN', 'C_AC_SCROLL_UP', 'C_AC_SEARCH', 'C_AC_SEND',
 'C_AC_STOP', 'C_AC_UNDO', 'C_AC_VIEW_TOGGLE', 'C_AC_ZOOM', 'C_AC_ZOOM_IN',
 'C_AC_ZOOM_OUT', 'C_ALTERNATE_AUDIO_INCREMENT', 'C_ALT_AUDIO_INC',
 'C_AL_ADDRESS_BOOK', 'C_AL_AUDIO', 'C_AL_AUDIO_BROWSER',
 'C_AL_AV_CAPTURE_PLAYBACK', 'C_AL_CAL', 'C_AL_CALC', 'C_AL_CALCULATOR',
 'C_AL_CALENDAR', 'C_AL_CCC', 'C_AL_CHAT', 'C_AL_COFFEE', 'C_AL_CONTACTS',
 'C_AL_CONTROL_PANEL', 'C_AL_DATABASE', 'C_AL_DB', 'C_AL_DOCS',
 'C_AL_DOCUMENTS', 'C_AL_EMAIL', 'C_AL_FILES', 'C_AL_FILE_BROWSER',
 'C_AL_FINANCE', 'C_AL_GRAPHICS_EDITOR', 'C_AL_HELP', 'C_AL_IM', 'C_AL_IMAGES',
 'C_AL_IMAGE_BROWSER', 'C_AL_INSTANT_MESSAGING', 'C_AL_JOURNAL',
 'C_AL_KEYBOARD_LAYOUT', 'C_AL_LOCK', 'C_AL_LOGOFF', 'C_AL_MAIL', 'C_AL_MOVIES',
 'C_AL_MOVIE_BROWSER', 'C_AL_MUSIC', 'C_AL_MY_COMPUTER', 'C_AL_NETWORK_CHAT',
 'C_AL_NEWS', 'C_AL_NEXT_TASK', 'C_AL_OEM_FEATURES', 'C_AL_PRESENTATION',
 'C_AL_PREVIOUS_TASK', 'C_AL_PREV_TASK', 'C_AL_SCREENSAVER',
 'C_AL_SCREEN_SAVER', 'C_AL_SELECT_TASK', 'C_AL_SHEET', 'C_AL_SPELL',
 'C_AL_SPELLCHECK', 'C_AL_SPREADSHEET', 'C_AL_TASK_MANAGER', 'C_AL_TEXT_EDITOR',
 'C_AL_TIPS', 'C_AL_TUTORIAL', 'C_AL_VOICEMAIL', 'C_AL_WORD', 'C_AL_WWW',
 'C_ASPECT', 'C_BACKLIGHT_TOGGLE', 'C_BASS_BOOST', 'C_BKLT_TOG', 'C_BLUE',
 'C_BLUE_BUTTON', 'C_BRIGHTNESS_AUTO', 'C_BRIGHTNESS_DEC', 'C_BRIGHTNESS_INC',
 'C_BRIGHTNESS_MAXIMUM', 'C_BRIGHTNESS_MINIMUM', 'C_BRI_AUTO', 'C_BRI_DEC',
 'C_BRI_DN', 'C_BRI_INC', 'C_BRI_MAX', 'C_BRI_MIN', 'C_BRI_UP', 'C_CAPTIONS',
 'C_CHANNEL_DEC', 'C_CHANNEL_INC', 'C_CHAN_DEC', 'C_CHAN_INC', 'C_CHAN_LAST',
 'C_DATA_ON_SCREEN', 'C_EJECT', 'C_FAST_FORWARD', 'C_FF', 'C_GREEN',
 'C_GREEN_BUTTON', 'C_HELP', 'C_KBIA_ACCEPT', 'C_KBIA_CANCEL', 'C_KBIA_NEXT',
 'C_KBIA_NEXT_GRP', 'C_KBIA_PREV', 'C_KBIA_PREV_GRP',
 'C_KEYBOARD_INPUT_ASSIST_ACCEPT', 'C_KEYBOARD_INPUT_ASSIST_CANCEL',
 'C_KEYBOARD_INPUT_ASSIST_NEXT', 'C_KEYBOARD_INPUT_ASSIST_NEXT_GROUP',
 'C_KEYBOARD_INPUT_ASSIST_PREVIOUS', 'C_KEYBOARD_INPUT_ASSIST_PREVIOUS_GROUP',
 'C_MEDIA_CABLE', 'C_MEDIA_CD', 'C_MEDIA_COMPUTER', 'C_MEDIA_DVD',
 'C_MEDIA_GAMES', 'C_MEDIA_GUIDE', 'C_MEDIA_HOME', 'C_MEDIA_MESSAGES',
 'C_MEDIA_PHONE', 'C_MEDIA_SATELLITE', 'C_MEDIA_STEP', 'C_MEDIA_TAPE',
 'C_MEDIA_TUNER', 'C_MEDIA_TV', 'C_MEDIA_VCR', 'C_MEDIA_VCR_PLUS',
 'C_MEDIA_VIDEOPHONE', 'C_MEDIA_WWW', 'C_MENU', 'C_MENU_DEC', 'C_MENU_DECREASE',
 'C_MENU_DOWN', 'C_MENU_ESC', 'C_MENU_ESCAPE', 'C_MENU_INC', 'C_MENU_INCREASE',
 'C_MENU_LEFT', 'C_MENU_PICK', 'C_MENU_RIGHT', 'C_MENU_SELECT', 'C_MENU_UP',
 'C_MODE_STEP', 'C_MUTE', 'C_NEXT', 'C_PAUSE', 'C_PIP', 'C_PLAY',
 'C_PLAY_PAUSE', 'C_POWER', 'C_PP', 'C_PREV', 'C_PREVIOUS', 'C_PWR', 'C_QUIT',
 'C_RANDOM_PLAY', 'C_REC', 'C_RECALL_LAST', 'C_RECORD', 'C_RED', 'C_RED_BUTTON',
 'C_REPEAT', 'C_RESET', 'C_REWIND', 'C_RW', 'C_SHUFFLE', 'C_SLEEP',
 'C_SLEEP_MODE', 'C_SLOW', 'C_SLOW2', 'C_SLOW_TRACKING', 'C_SNAPSHOT', 'C_STOP',
 'C_STOP_EJECT', 'C_SUBTITLES', 'C_VOICE_COMMAND', 'C_VOLUME_DOWN',
 'C_VOLUME_UP', 'C_VOL_DN', 'C_VOL_UP', 'C_YELLOW', 'C_YELLOW_BUTTON', 'D',
 'DEL', 'DELETE', 'DLLR', 'DOLLAR', 'DOT', 'DOUBLE_QUOTES', 'DOWN',
 'DOWN_ARROW', 'DQT', 'E', 'END', 'ENTER', 'EQUAL', 'ESC', 'ESCAPE', 'EXCL',
 'EXCLAMATION', 'EXSEL', 'F', 'F1', 'F10', 'F11', 'F12', 'F13', 'F14', 'F15',
 'F16', 'F17', 'F18', 'F19', 'F2', 'F20', 'F21', 'F22', 'F23', 'F24', 'F3',
 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'FSLH', 'G', 'GLOBE', 'GRAVE',
 'GREATER_THAN', 'GT', 'H', 'HASH', 'HOME', 'I', 'INS', 'INSERT', 'INT1',
 'INT2', 'INT3', 'INT4', 'INT5', 'INT6', 'INT7', 'INT8', 'INT9',
 'INTERNATIONAL_1', 'INTERNATIONAL_2', 'INTERNATIONAL_3', 'INTERNATIONAL_4',
 'INTERNATIONAL_5', 'INTERNATIONAL_6', 'INTERNATIONAL_7', 'INTERNATIONAL_8',
 'INTERNATIONAL_9', 'INT_HENKAN', 'INT_KANA', 'INT_KATAKANAHIRAGANA',
 'INT_KPJPCOMMA', 'INT_MUHENKAN', 'INT_RO', 'INT_YEN', 'J', 'K', 'KP_ASTERISK',
 'KP_CLEAR', 'KP_COMMA', 'KP_DIVIDE', 'KP_DOT', 'KP_ENTER', 'KP_EQUAL',
 'KP_EQUAL_AS400', 'KP_LEFT_PARENTHESIS', 'KP_LPAR', 'KP_MINUS', 'KP_MULTIPLY',
 'KP_N0', 'KP_N1', 'KP_N2', 'KP_N3', 'KP_N4', 'KP_N5', 'KP_N6', 'KP_N7',
 'KP_N8', 'KP_N9', 'KP_NLCK', 'KP_NUM', 'KP_NUMBER_0', 'KP_NUMBER_1',
 'KP_NUMBER_2', 'KP_NUMBER_3', 'KP_NUMBER_4', 'KP_NUMBER_5', 'KP_NUMBER_6',
 'KP_NUMBER_7', 'KP_NUMBER_8', 'KP_NUMBER_9', 'KP_NUMLOCK', 'KP_PLUS',
 'KP_RIGHT_PARENTHESIS', 'KP_RPAR', 'KP_SLASH', 'KP_SUBTRACT', 'KSPC',
 'K_AGAIN', 'K_APP', 'K_APPLICATION', 'K_BACK', 'K_CALC', 'K_CALCULATOR',
 'K_CANCEL', 'K_CMENU', 'K_COFFEE', 'K_CONTEXT_MENU', 'K_COPY', 'K_CUT',
 'K_EDIT', 'K_EJECT', 'K_EXEC', 'K_EXECUTE', 'K_FIND', 'K_FIND2', 'K_FORWARD',
 'K_HELP', 'K_LOCK', 'K_MENU', 'K_MUTE', 'K_MUTE2', 'K_NEXT', 'K_PASTE',
 'K_PLAY_PAUSE', 'K_POWER', 'K_PP', 'K_PREV', 'K_PREVIOUS', 'K_PWR', 'K_REDO',
 'K_REFRESH', 'K_SCREENSAVER', 'K_SCROLL_DOWN', 'K_SCROLL_UP', 'K_SELECT',
 'K_SLEEP', 'K_STOP', 'K_STOP2', 'K_STOP3', 'K_UNDO', 'K_VOLUME_DOWN',
 'K_VOLUME_DOWN2', 'K_VOLUME_UP', 'K_VOLUME_UP2', 'K_VOL_DN', 'K_VOL_DN2',
 'K_VOL_UP', 'K_VOL_UP2', 'K_WWW', 'L', 'LALT', 'LANG1', 'LANG2', 'LANG3',
 'LANG4', 'LANG5', 'LANG6', 'LANG7', 'LANG8', 'LANG9', 'LANGUAGE_1',
 'LANGUAGE_2', 'LANGUAGE_3', 'LANGUAGE_4', 'LANGUAGE_5', 'LANGUAGE_6',
 'LANGUAGE_7', 'LANGUAGE_8', 'LANGUAGE_9', 'LANG_HANGEUL', 'LANG_HANJA',
 'LANG_HIRAGANA', 'LANG_KATAKANA', 'LANG_ZENKAKUHANKAKU', 'LBKT', 'LBRC',
 'LCAPS', 'LCMD', 'LCTRL', 'LEFT', 'LEFT_ALT', 'LEFT_ARROW', 'LEFT_BRACE',
 'LEFT_BRACKET', 'LEFT_COMMAND', 'LEFT_CONTROL', 'LEFT_GUI', 'LEFT_META',
 'LEFT_PARENTHESIS', 'LEFT_SHIFT', 'LEFT_WIN', 'LESS_THAN', 'LGUI', 'LMETA',
 'LNLCK', 'LOCKING_CAPS', 'LOCKING_NUM', 'LOCKING_SCROLL', 'LPAR', 'LSHFT',
 'LSHIFT', 'LSLCK', 'LT', 'LWIN', 'M', 'MINUS', 'N', 'N0', 'N1', 'N2', 'N3',
 'N4', 'N5', 'N6', 'N7', 'N8', 'N9', 'NON_US_BACKSLASH', 'NON_US_BSLH',
 'NON_US_HASH', 'NUBS', 'NUHS', 'NUMBER_0', 'NUMBER_1', 'NUMBER_2', 'NUMBER_3',
 'NUMBER_4', 'NUMBER_5', 'NUMBER_6', 'NUMBER_7', 'NUMBER_8', 'NUMBER_9', 'O',
 'OPER', 'OUT', 'P', 'PAGE_DOWN', 'PAGE_UP', 'PAUSE_BREAK', 'PERCENT', 'PERIOD',
 'PG_DN', 'PG_UP', 'PIPE', 'PIPE2', 'PLUS', 'POUND', 'PRCNT', 'PRINTSCREEN',
 'PRIOR', 'PSCRN', 'Q', 'QMARK', 'QUESTION', 'R', 'RALT', 'RBKT', 'RBRC',
 'RCMD', 'RCTRL', 'RET', 'RET2', 'RETURN', 'RETURN2', 'RGUI', 'RIGHT',
 'RIGHT_ALT', 'RIGHT_ARROW', 'RIGHT_BRACE', 'RIGHT_BRACKET', 'RIGHT_COMMAND',
 'RIGHT_CONTROL', 'RIGHT_GUI', 'RIGHT_META', 'RIGHT_PARENTHESIS', 'RIGHT_SHIFT',
 'RIGHT_WIN', 'RMETA', 'RPAR', 'RSHFT', 'RSHIFT', 'RWIN', 'S', 'SCROLLLOCK',
 'SEMI', 'SEMICOLON', 'SEPARATOR', 'SINGLE_QUOTE', 'SLASH', 'SLCK', 'SPACE',
 'SQT', 'STAR', 'SYSREQ', 'SYSTEM_POWER', 'SYSTEM_SLEEP', 'SYSTEM_WAKE_UP',
 'SYS_PWR', 'SYS_SLEEP', 'SYS_WAKE', 'T', 'TAB', 'TILDE', 'TILDE2', 'U',
 'UNDER', 'UNDERSCORE', 'UP', 'UP_ARROW', 'V', 'W', 'X', 'Y', 'Z'}
# fmt: on

ZMK_KEYCODES_ALIASES = {
    "0": "N0",
    "1": "N1",
    "2": "N2",
    "3": "N3",
    "4": "N4",
    "5": "N5",
    "6": "N6",
    "7": "N7",
    "8": "N8",
    "9": "N9",
    #
    "!": "EXCL",
    "@": "AT",
    "#": "HASH",
    "$": "DLLR",
    "%": "PRCNT",
    "^": "CARET",
    "&": "AMPS",
    "*": "STAR",
    "(": "LPAR",
    ")": "RPAR",
    "=": "EQUAL",
    "+": "PLUS",
    "-": "MINUS",
    "_": "UNDER",
    "/": "FSLH",
    "?": "QMARK",
    "\\": "BSLH",
    "|": "PIPE",
    ";": "SEMI",
    ":": "COLON",
    "'": "SQT",
    '"': "DQT",
    ",": "COMMA",
    "<": "LT",
    ".": "DOT",
    ">": "GT",
    "[": "LBKT",
    "{": "LBRC",
    "]": "RBKT",
    "}": "RBRC",
    "`": "GRAVE",
    "~": "TILDE",
    #
    "SHIFT": "LSHFT",
    "⇧": "LSHFT",
    "CTRL": "LCTRL",
    "⌃": "LCTRL",
    "ALT": "LALT",
    "⌥": "LALT",
    "GUI": "LGUI",
    "WIN": "LGUI",
    "CMD": "LGUI",
    "META": "LGUI",
    "SUPER": "LGUI",
    "⌘": "LGUI",
    #
    "ろ": "INT1",
    "かな": "INT2",
    "¥": "INT3",
    "変換": "INT4",
    "無変換": "INT5",
    "カソマ": "INT6",
    "한/영": "LANG1",
    "한자": "LANG2",
    "カタカナ": "LANG3",
    "ひらがな": "LANG4",
    "半角/全角": "LANG5",
    #
    "KP0": "KP_N0",
    "KP1": "KP_N1",
    "KP2": "KP_N2",
    "KP3": "KP_N3",
    "KP4": "KP_N4",
    "KP5": "KP_N5",
    "KP6": "KP_N6",
    "KP7": "KP_N7",
    "KP8": "KP_N8",
    "KP9": "KP_N9",
    "KP+": "KP_PLUS",
    "KP-": "KP_MINUS",
    "KP*": "KP_MULTIPLY",
    "KP/": "KP_SLASH",
    "KP=": "KP_EQUAL",
    "KP.": "KP_DOT",
    "KP,": "KP_COMMA",
    "KP(": "KP_LPAR",
    "KP)": "KP_RPAR",
}

if __name__ == "__main__":
    parser = ArgumentParser()
    parser.add_argument("zmk_dir")
    args = parser.parse_args()

    keys_h_path = Path(args.zmk_dir) / "app/include/dt-bindings/zmk/keys.h"

    keycodes: set[str] = set()
    for line in open(keys_h_path):
        if m := re.match(r"\s*#define\s+(\w+)\s*(.+)", line):
            if "deprecated" not in line.lower():
                keycodes.add(m.group(1))

    print(
        re.sub(
            r"(ZMK_KEYCODES = ){[^)]+}",
            rf"\1{pformat(keycodes, compact=True)}",
            Path(__file__).read_text(),
            flags=re.DOTALL,
        )
    )
